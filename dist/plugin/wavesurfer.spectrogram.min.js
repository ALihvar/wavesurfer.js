/*!
 * wavesurfer.js spectrogram plugin 6.0.4 (2022-09-28)
 * https://wavesurfer-js.org
 * @license BSD-3-Clause
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WaveSurfer",[],t):"object"==typeof exports?exports.WaveSurfer=t():(e.WaveSurfer=e.WaveSurfer||{},e.WaveSurfer.spectrogram=t())}(self,(()=>(()=>{"use strict";var e={d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function a(e,t,a,r){switch(this.bufferSize=e,this.sampleRate=t,this.bandwidth=2/e*(t/2),this.sinTable=new Float32Array(e),this.cosTable=new Float32Array(e),this.windowValues=new Float32Array(e),this.reverseTable=new Uint32Array(e),this.peakBand=0,this.peak=0,a){case"bartlett":for(s=0;s<e;s++)this.windowValues[s]=2/(e-1)*((e-1)/2-Math.abs(s-(e-1)/2));break;case"bartlettHann":for(s=0;s<e;s++)this.windowValues[s]=.62-.48*Math.abs(s/(e-1)-.5)-.38*Math.cos(2*Math.PI*s/(e-1));break;case"blackman":for(r=r||.16,s=0;s<e;s++)this.windowValues[s]=(1-r)/2-.5*Math.cos(2*Math.PI*s/(e-1))+r/2*Math.cos(4*Math.PI*s/(e-1));break;case"cosine":for(s=0;s<e;s++)this.windowValues[s]=Math.cos(Math.PI*s/(e-1)-Math.PI/2);break;case"gauss":for(r=r||.25,s=0;s<e;s++)this.windowValues[s]=Math.pow(Math.E,-.5*Math.pow((s-(e-1)/2)/(r*(e-1)/2),2));break;case"hamming":for(s=0;s<e;s++)this.windowValues[s]=.54-.46*Math.cos(2*Math.PI*s/(e-1));break;case"hann":case void 0:for(s=0;s<e;s++)this.windowValues[s]=.5*(1-Math.cos(2*Math.PI*s/(e-1)));break;case"lanczoz":for(s=0;s<e;s++)this.windowValues[s]=Math.sin(Math.PI*(2*s/(e-1)-1))/(Math.PI*(2*s/(e-1)-1));break;case"rectangular":for(s=0;s<e;s++)this.windowValues[s]=1;break;case"triangular":for(s=0;s<e;s++)this.windowValues[s]=2/e*(e/2-Math.abs(s-(e-1)/2));break;default:throw Error("No such window function '"+a+"'")}for(var s,i=1,n=e>>1;i<e;){for(s=0;s<i;s++)this.reverseTable[s+i]=this.reverseTable[s]+n;i<<=1,n>>=1}for(s=0;s<e;s++)this.sinTable[s]=Math.sin(-Math.PI/s),this.cosTable[s]=Math.cos(-Math.PI/s);this.calculateSpectrum=function(e){var t,a,r,s=this.bufferSize,i=this.cosTable,n=this.sinTable,h=this.reverseTable,l=new Float32Array(s),o=new Float32Array(s),c=2/this.bufferSize,f=Math.sqrt,p=new Float32Array(s/2),d=Math.floor(Math.log(s)/Math.LN2);if(Math.pow(2,d)!==s)throw"Invalid buffer size, must be a power of 2.";if(s!==e.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+s+" Buffer Size: "+e.length;for(var u,w,m,b,M,v,y,g,S=1,x=0;x<s;x++)l[x]=e[h[x]]*this.windowValues[h[x]],o[x]=0;for(;S<s;){u=i[S],w=n[S],m=1,b=0;for(var k=0;k<S;k++){for(x=k;x<s;)v=m*l[M=x+S]-b*o[M],y=m*o[M]+b*l[M],l[M]=l[x]-v,o[M]=o[x]-y,l[x]+=v,o[x]+=y,x+=S<<1;m=(g=m)*u-b*w,b=g*w+b*u}S<<=1}x=0;for(var C=s/2;x<C;x++)(r=c*f((t=l[x])*t+(a=o[x])*a))>this.peak&&(this.peakBand=x,this.peak=r),p[x]=r;return p}}e.r(t),e.d(t,{default:()=>r});class r{static create(e){return{name:"spectrogram",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,staticProps:{FFT:a},instance:r}}constructor(e,t){this.params=e,this.wavesurfer=t,this.util=t.util,this.frequenciesDataUrl=e.frequenciesDataUrl,this._onScroll=e=>{this.updateScroll(e)},this._onRender=()=>{this.render()},this._onWrapperClick=e=>{this._wrapperClickHandler(e)},this._onReady=()=>{const a=this.drawer=t.drawer;if(this.container="string"==typeof e.container?document.querySelector(e.container):e.container,!this.container)throw Error("No container for WaveSurfer spectrogram");if(e.colorMap){if(e.colorMap.length<256)throw new Error("Colormap must contain 256 elements");for(let t=0;t<e.colorMap.length;t++){if(4!==e.colorMap[t].length)throw new Error("ColorMap entries must contain 4 values")}this.colorMap=e.colorMap}else{this.colorMap=[];for(let e=0;e<256;e++){const t=(255-e)/256;this.colorMap.push([t,t,t,1])}}this.width=a.width,this.pixelRatio=this.params.pixelRatio||t.params.pixelRatio,this.fftSamples=this.params.fftSamples||t.params.fftSamples||512,this.height=this.fftSamples/2,this.noverlap=e.noverlap,this.windowFunc=e.windowFunc,this.alpha=e.alpha,this.splitChannels=e.splitChannels,this.channels=this.splitChannels?t.backend.buffer.numberOfChannels:1,this.frequencyMin=e.frequencyMin||0,this.frequencyMax=e.frequencyMax||12e3,this.createWrapper(),this.createCanvas(),this.render(),a.wrapper.addEventListener("scroll",this._onScroll),t.on("redraw",this._onRender)}}init(){this.wavesurfer.isReady?this._onReady():this.wavesurfer.once("ready",this._onReady)}destroy(){this.unAll(),this.wavesurfer.un("ready",this._onReady),this.wavesurfer.un("redraw",this._onRender),this.drawer&&this.drawer.wrapper.removeEventListener("scroll",this._onScroll),this.wavesurfer=null,this.util=null,this.params=null,this.wrapper&&(this.wrapper.removeEventListener("click",this._onWrapperClick),this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null)}createWrapper(){const e=this.container.querySelector("spectrogram");e&&this.container.removeChild(e);const t=this.wavesurfer.params;if(this.wrapper=document.createElement("spectrogram"),this.params.labels){const e=this.labelsEl=document.createElement("canvas");e.classList.add("spec-labels"),this.drawer.style(e,{left:0,position:"absolute",zIndex:9,height:this.height*this.channels/this.pixelRatio+"px",width:55/this.pixelRatio+"px"}),this.wrapper.appendChild(e),this.loadLabels("rgba(68,68,68,0.5)","12px","10px","","#fff","#f7f7f7","center","#specLabels")}this.drawer.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.height*this.channels/this.pixelRatio+"px"}),(t.fillParent||t.scrollParent)&&this.drawer.style(this.wrapper,{width:"100%",overflowX:"hidden",overflowY:"hidden"}),this.container.appendChild(this.wrapper),this.wrapper.addEventListener("click",this._onWrapperClick)}_wrapperClickHandler(e){e.preventDefault();const t="offsetX"in e?e.offsetX:e.layerX;this.fireEvent("click",t/this.width||0)}createCanvas(){const e=this.canvas=this.wrapper.appendChild(document.createElement("canvas"));this.spectrCc=e.getContext("2d"),this.util.style(e,{position:"absolute",zIndex:4})}render(){this.updateCanvasStyle(),this.frequenciesDataUrl?this.loadFrequenciesData(this.frequenciesDataUrl):this.getFrequencies(this.drawSpectrogram)}updateCanvasStyle(){const e=Math.round(this.width/this.pixelRatio)+"px";this.canvas.width=this.width,this.canvas.height=this.height*this.channels,this.canvas.style.width=e}drawSpectrogram(e,t){isNaN(e[0][0])||(e=[e]);const a=t.spectrCc,r=t.height,s=t.width,i=t.buffer.sampleRate/2,n=t.frequencyMin,h=t.frequencyMax;if(a)for(let l=0;l<e.length;l++){const o=t.resample(e[l]),c=new ImageData(s,r);for(let e=0;e<o.length;e++)for(let a=0;a<o[e].length;a++){const i=t.colorMap[o[e][a]],n=4*((r-a)*s+e);c.data[n]=255*i[0],c.data[n+1]=255*i[1],c.data[n+2]=255*i[2],c.data[n+3]=255*i[3]}createImageBitmap(c).then((e=>a.drawImage(e,0,r*(1-h/i),s,r*(h-n)/i,0,r*l,s,r)))}}getFrequencies(e){const t=this.fftSamples,r=this.buffer=this.wavesurfer.backend.buffer,s=this.channels;if(!r)return void this.fireEvent("error","Web Audio buffer is not available");const i=r.sampleRate,n=[];let h=this.noverlap;if(!h){const e=r.length/this.canvas.width;h=Math.max(0,Math.round(t-e))}const l=new a(t,i,this.windowFunc,this.alpha);for(let e=0;e<s;e++){const a=r.getChannelData(e),s=[];let i=0;for(;i+t<a.length;){const e=a.slice(i,i+t),r=l.calculateSpectrum(e),n=new Uint8Array(t/2);let o;for(o=0;o<t/2;o++)n[o]=Math.max(-255,45*Math.log10(r[o]));s.push(n),i+=t-h}n.push(s)}e(n,this)}loadFrequenciesData(e){const t=this.util.fetchFile({url:e});return t.on("success",(e=>this.drawSpectrogram(JSON.parse(e),this))),t.on("error",(e=>this.fireEvent("error",e))),t}freqType(e){return e>=1e3?(e/1e3).toFixed(1):Math.round(e)}unitType(e){return e>=1e3?"KHz":"Hz"}loadLabels(e,t,a,r,s,i,n,h){e=e||"rgba(68,68,68,0)",t=t||"12px",a=a||"10px",r=r||"Helvetica",s=s||"#fff",i=i||"#fff",n=n||"center",h=h||"#specLabels";const l=this.height||512,o=l/256*5,c=this.frequencyMin,f=(this.frequencyMax-c)/o,p=this.labelsEl.getContext("2d");if(this.labelsEl.height=this.height*this.channels,this.labelsEl.width=55,p)for(let h=0;h<this.channels;h++){let d;for(p.fillStyle=e,p.fillRect(0,h*l,55,(1+h)*l),p.fill(),d=0;d<=o;d++){p.textAlign=n,p.textBaseline="middle";const e=c+f*d,o=this.freqType(e),u=this.unitType(e),w=2,m=16;let b;0==d?(b=(1+h)*l+d-10,p.fillStyle=i,p.font=a+" "+r,p.fillText(u,m+24,b),p.fillStyle=s,p.font=t+" "+r,p.fillText(o,m,b)):(b=(1+h)*l-50*d+w,p.fillStyle=i,p.font=a+" "+r,p.fillText(u,m+24,b),p.fillStyle=s,p.font=t+" "+r,p.fillText(o,m,b))}}}updateScroll(e){this.wrapper&&(this.wrapper.scrollLeft=e.target.scrollLeft)}resample(e){const t=this.width,a=[],r=1/e.length,s=1/t;let i;for(i=0;i<t;i++){const t=new Array(e[0].length);let n;for(n=0;n<e.length;n++){const a=n*r,h=a+r,l=i*s,o=l+s,c=h<=l||o<=a?0:Math.min(Math.max(h,l),Math.max(o,a))-Math.max(Math.min(h,l),Math.min(o,a));let f;if(c>0)for(f=0;f<e[0].length;f++)null==t[f]&&(t[f]=0),t[f]+=c/s*e[n][f]}const h=new Uint8Array(e[0].length);let l;for(l=0;l<e[0].length;l++)h[l]=t[l];a.push(h)}return a}}return t})()));
//# sourceMappingURL=wavesurfer.spectrogram.min.js.map