/*!
 * wavesurfer.js regions plugin 6.0.4 (2022-09-28)
 * https://wavesurfer-js.org
 * @license BSD-3-Clause
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WaveSurfer",[],t):"object"==typeof exports?exports.WaveSurfer=t():(e.WaveSurfer=e.WaveSurfer||{},e.WaveSurfer.regions=t())}(self,(()=>(()=>{"use strict";var e={d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>s});class i{constructor(e,t,i){this.wavesurfer=i,this.wrapper=i.drawer.wrapper,this.util=i.util,this.style=this.util.style,this.regionsUtil=t,this.vertical=i.drawer.params.vertical,this.id=null==e.id?i.util.getId():e.id,this.start=Number(e.start)||0,this.end=null==e.end?this.start+4/this.wrapper.scrollWidth*this.wavesurfer.getDuration():Number(e.end),this.resize=void 0===e.resize||Boolean(e.resize),this.drag=void 0===e.drag||Boolean(e.drag),this.isResizing=!1,this.isDragging=!1,this.loop=Boolean(e.loop),this.color=e.color||"rgba(0, 0, 0, 0.1)",this.handleStyle=e.handleStyle||{left:{},right:{}},this.handleLeftEl=null,this.handleRightEl=null,this.data=e.data||{},this.attributes=e.attributes||{},this.showTooltip=e.showTooltip??!0,this.maxLength=e.maxLength,this.minLength=e.minLength,this._onRedraw=()=>this.updateRender(),this.scroll=!1!==e.scroll&&i.params.scrollParent,this.scrollSpeed=e.scrollSpeed||1,this.scrollThreshold=e.scrollThreshold||10,this.preventContextMenu=void 0!==e.preventContextMenu&&Boolean(e.preventContextMenu);let s=null==e.channelIdx?-1:parseInt(e.channelIdx),r=i.regions.params.channelCount&&i.params.splitChannels?i.regions.params.channelCount:-1;s>=i.regions.params.channelCount?this.regionHeight="0%":(this.channelIdx=s,this.regionHeight="100%",this.marginTop="0px",-1!==s&&r>=0&&(this.regionHeight=Math.floor(1/r*100)+"%",this.marginTop=this.wavesurfer.getHeight()*s+"px"),this.formatTimeCallback=e.formatTimeCallback,this.edgeScrollWidth=e.edgeScrollWidth,this.bindInOut(),this.render(),this.wavesurfer.on("zoom",this._onRedraw),this.wavesurfer.on("redraw",this._onRedraw),this.wavesurfer.fireEvent("region-created",this))}update(e,t){null!=e.start&&(this.start=Number(e.start)),null!=e.end&&(this.end=Number(e.end)),null!=e.loop&&(this.loop=Boolean(e.loop)),null!=e.color&&(this.color=e.color),null!=e.handleStyle&&(this.handleStyle=e.handleStyle),null!=e.data&&(this.data=e.data),null!=e.resize&&(this.resize=Boolean(e.resize),this.updateHandlesResize(this.resize)),null!=e.drag&&(this.drag=Boolean(e.drag)),null!=e.maxLength&&(this.maxLength=Number(e.maxLength)),null!=e.minLength&&(this.minLength=Number(e.minLength)),null!=e.attributes&&(this.attributes=e.attributes),this.updateRender(),this.fireEvent("update"),this.wavesurfer.fireEvent("region-updated",this,t)}remove(){this.element&&(this.wrapper.removeChild(this.element.domElement),this.element=null,this.fireEvent("remove"),this.wavesurfer.un("zoom",this._onRedraw),this.wavesurfer.un("redraw",this._onRedraw),this.wavesurfer.fireEvent("region-removed",this))}play(e){const t=e||this.start;this.wavesurfer.play(t,this.end),this.fireEvent("play"),this.wavesurfer.fireEvent("region-play",this)}playLoop(e){this.loop=!0,this.play(e)}setLoop(e){this.loop=e}render(){this.element=this.util.withOrientation(this.wrapper.appendChild(document.createElement("region")),this.vertical),this.element.className="wavesurfer-region",this.showTooltip&&(this.element.title=this.formatTime(this.start,this.end)),this.element.setAttribute("data-id",this.id);for(const e in this.attributes)this.element.setAttribute("data-region-"+e,this.attributes[e]);if(this.style(this.element,{position:"absolute",height:this.regionHeight,top:this.marginTop}),this.resize){this.handleLeftEl=this.util.withOrientation(this.element.appendChild(document.createElement("handle")),this.vertical),this.handleRightEl=this.util.withOrientation(this.element.appendChild(document.createElement("handle")),this.vertical),this.handleLeftEl.className="wavesurfer-handle wavesurfer-handle-start",this.handleRightEl.className="wavesurfer-handle wavesurfer-handle-end";const e={cursor:this.vertical?"row-resize":"col-resize",position:"absolute",top:"0px",width:"2px",height:"100%",backgroundColor:"rgba(0, 0, 0, 1)"},t="none"!==this.handleStyle.left?Object.assign({left:"0px"},e,this.handleStyle.left):null,i="none"!==this.handleStyle.right?Object.assign({right:"0px"},e,this.handleStyle.right):null;t&&this.style(this.handleLeftEl,t),i&&this.style(this.handleRightEl,i)}this.updateRender(),this.bindEvents()}formatTime(e,t){return this.formatTimeCallback?this.formatTimeCallback(e,t):(e==t?[e]:[e,t]).map((e=>[Math.floor(e%3600/60),("00"+Math.floor(e%60)).slice(-2)].join(":"))).join("-")}getWidth(){return this.wavesurfer.drawer.width/this.wavesurfer.params.pixelRatio}updateRender(){const e=this.wavesurfer.getDuration(),t=this.getWidth();let i=this.start,s=this.end;if(i<0&&(i=0,s-=i),s>e&&(s=e,i=e-(s-i)),null!=this.minLength&&(s=Math.max(i+this.minLength,s)),null!=this.maxLength&&(s=Math.min(i+this.maxLength,s)),null!=this.element){const r=Math.round(i/e*t),n=Math.round(s/e*t)-r;this.style(this.element,{left:r+"px",width:n+"px",backgroundColor:this.color,cursor:this.drag?"move":"default"});for(const e in this.attributes)this.element.setAttribute("data-region-"+e,this.attributes[e]);this.showTooltip&&(this.element.title=this.formatTime(this.start,this.end))}}bindInOut(){this.firedIn=!1,this.firedOut=!1;const e=e=>{let t=Math.round(10*this.start)/10,i=Math.round(10*this.end)/10;e=Math.round(10*e)/10,!this.firedOut&&this.firedIn&&(t>e||i<=e)&&(this.firedOut=!0,this.firedIn=!1,this.fireEvent("out"),this.wavesurfer.fireEvent("region-out",this)),!this.firedIn&&t<=e&&i>e&&(this.firedIn=!0,this.firedOut=!1,this.fireEvent("in"),this.wavesurfer.fireEvent("region-in",this))};this.wavesurfer.backend.on("audioprocess",e),this.on("remove",(()=>{this.wavesurfer.backend.un("audioprocess",e)})),this.on("out",(()=>{if(this.loop){const e=this.wavesurfer.getCurrentTime();e>=this.start&&e<=this.end&&this.wavesurfer.play(this.start)}}))}bindEvents(){const e=this.preventContextMenu;this.element.addEventListener("mouseenter",(e=>{this.fireEvent("mouseenter",e),this.wavesurfer.fireEvent("region-mouseenter",this,e)})),this.element.addEventListener("mouseleave",(e=>{this.fireEvent("mouseleave",e),this.wavesurfer.fireEvent("region-mouseleave",this,e)})),this.element.addEventListener("click",(e=>{e.preventDefault(),this.fireEvent("click",e),this.wavesurfer.fireEvent("region-click",this,e)})),this.element.addEventListener("dblclick",(e=>{e.stopPropagation(),e.preventDefault(),this.fireEvent("dblclick",e),this.wavesurfer.fireEvent("region-dblclick",this,e)})),this.element.addEventListener("contextmenu",(t=>{e&&t.preventDefault(),this.fireEvent("contextmenu",t),this.wavesurfer.fireEvent("region-contextmenu",this,t)})),(this.drag||this.resize)&&this.bindDragEvents()}bindDragEvents(){const e=this.wavesurfer.drawer.container,t=this.scrollSpeed;this.scrollThreshold;let i,s,r,n,a,h,o,l,d,u=!1;const c=e=>{let s=this.util.withOrientation(e,this.vertical);const u=this.wavesurfer.getDuration();if(!h||!r&&!a)return;const g=s.clientX;let p=0,v=0,m=0,f=this.regionsUtil.getRegionSnapToGridValue(this.wavesurfer.drawer.handleEvent(e)*u);if(r)-1===h?(v=l*this.wavesurfer.params.minPxPerSec,p=g-o.left):(v=d*this.wavesurfer.params.minPxPerSec,p=o.right-g);else{let e=this.minLength;e||(e=0),"start"===a?(f>this.end-e&&(f=this.end-e,m=t*h),f<0&&(f=0)):"end"===a&&(f<this.start+e&&(f=this.start+e,m=t*h),f>u&&(f=u))}const w=this.wrapper.scrollLeft;if(-1===h){if(0===Math.round(w))return;if(Math.round(w-v+p)<=0)return}else{if(Math.round(w)===n)return;if(Math.round(w+v-p)>=n)return}let E=w-m+t*h;if(-1===h){const e=Math.max(0+v-p,E);this.wrapper.scrollLeft=E=e}else{const e=Math.min(n-v+p,E);this.wrapper.scrollLeft=E=e}const b=f-i;i=f,r?this.onDrag(b):this.onResize(b,a),window.requestAnimationFrame((()=>{c(e)}))},g=e=>{const t=this.wavesurfer.getDuration();e.touches&&e.touches.length>1||(s=e.targetTouches?e.targetTouches[0].identifier:null,(this.drag||this.resize)&&e.stopPropagation(),i=this.regionsUtil.getRegionSnapToGridValue(this.wavesurfer.drawer.handleEvent(e,!0)*t),l=i-this.start,d=this.end-i,n=this.wrapper.scrollWidth-this.wrapper.clientWidth,o=this.util.withOrientation(this.wrapper.getBoundingClientRect(),this.vertical),this.isResizing=!1,this.isDragging=!1,"handle"===e.target.tagName.toLowerCase()?(this.isResizing=!0,a=e.target.classList.contains("wavesurfer-handle-start")?"start":"end"):(this.isDragging=!0,r=!0,a=!1))},p=e=>{e.touches&&e.touches.length>1||((r||a)&&(this.isDragging=!1,this.isResizing=!1,r=!1,h=null,a=!1),u&&(u=!1,this.util.preventClick(),this.fireEvent("update-end",e),this.wavesurfer.fireEvent("region-update-end",this,e)))},v=t=>{const n=this.wavesurfer.getDuration();let g=this.util.withOrientation(t,this.vertical);if(t.touches&&t.touches.length>1)return;if(t.targetTouches&&t.targetTouches[0].identifier!=s)return;if(!r&&!a)return;let p=this.regionsUtil.getRegionSnapToGridValue(this.wavesurfer.drawer.handleEvent(t)*n);if(r){const e=this.wavesurfer.getDuration();p>e-d&&(p=e-d),p-l<0&&(p=l)}if(a){let e=this.minLength;e||(e=0),"start"===a?(p>this.end-e&&(p=this.end-e),p<0&&(p=0)):"end"===a&&(p<this.start+e&&(p=this.start+e),p>n&&(p=n))}let v=p-i;if(i=p,this.drag&&r&&(u=u||!!v,this.onDrag(v)),this.resize&&a&&(u=u||!!v,this.onResize(v,a)),this.scroll&&e.clientWidth<this.wrapper.scrollWidth){let e=g.clientX;h=e<o.left+this.edgeScrollWidth?-1:e>o.right-this.edgeScrollWidth?1:null,h&&c(t)}};this.element.addEventListener("mousedown",g),this.element.addEventListener("touchstart",g),document.body.addEventListener("mousemove",v),document.body.addEventListener("touchmove",v,{passive:!1}),document.addEventListener("mouseup",p),document.body.addEventListener("touchend",p),this.on("remove",(()=>{document.removeEventListener("mouseup",p),document.body.removeEventListener("touchend",p),document.body.removeEventListener("mousemove",v),document.body.removeEventListener("touchmove",v)})),this.wavesurfer.on("destroy",(()=>{document.removeEventListener("mouseup",p),document.body.removeEventListener("touchend",p)}))}onDrag(e){const t=this.wavesurfer.getDuration();this.end+e>t&&(e=t-this.end),this.start+e<0&&(e=-1*this.start);const i={direction:this._getDragDirection(e),action:"drag"};this.update({start:this.start+e,end:this.end+e},i)}_getDragDirection(e){return e<0?"left":e>0?"right":null}onResize(e,t){const i=this.wavesurfer.getDuration(),s={action:"resize",direction:"start"===t?"left":"right"};"start"===t?(e>0&&this.end-(this.start+e)<this.minLength&&(e=this.end-this.minLength-this.start),e<0&&this.end-(this.start+e)>this.maxLength&&(e=this.end-this.start-this.maxLength),e<0&&this.start+e<0&&(e=-1*this.start),this.update({start:Math.min(this.start+e,this.end),end:Math.max(this.start+e,this.end)},s)):(e<0&&this.end+e-this.start<this.minLength&&(e=this.start+this.minLength-this.end),e>0&&this.end+e-this.start>this.maxLength&&(e=this.maxLength-(this.end-this.start)),e>0&&this.end+e>i&&(e=i-this.end),this.update({start:Math.min(this.end+e,this.start),end:Math.max(this.end+e,this.start)},s))}updateHandlesResize(e){let t;t=e?this.vertical?"row-resize":"col-resize":"auto",this.handleLeftEl&&this.style(this.handleLeftEl,{cursor:t}),this.handleRightEl&&this.style(this.handleRightEl,{cursor:t})}}class s{static create(e){return{name:"regions",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,staticProps:{addRegion(e){return this.initialisedPluginList.regions||this.initPlugin("regions"),this.regions.add(e)},clearRegions(){this.regions&&this.regions.clear()},enableDragSelection(e){this.initialisedPluginList.regions||this.initPlugin("regions"),this.regions.enableDragSelection(e)},disableDragSelection(){this.regions.disableDragSelection()}},instance:s}}constructor(e,t){this.params=e,this.wavesurfer=t,this.util={...t.util,getRegionSnapToGridValue:t=>this.getRegionSnapToGridValue(t,e)},this.maxRegions=e.maxRegions,this.regionsMinLength=e.regionsMinLength||null;Object.getOwnPropertyNames(this.util.Observer.prototype).forEach((e=>{i.prototype[e]=this.util.Observer.prototype[e]})),this.wavesurfer.Region=i;this._onBackendCreated=()=>{this.wrapper=this.wavesurfer.drawer.wrapper,this.orientation=this.wavesurfer.drawer.orientation,this.defaultEdgeScrollWidth=.05*this.wrapper.clientWidth,this.params.regions&&this.params.regions.forEach((e=>{this.add(e)}))},this.list={},this._onReady=()=>{this.wrapper=this.wavesurfer.drawer.wrapper,this.vertical=this.wavesurfer.drawer.params.vertical,this.params.dragSelection&&this.enableDragSelection(this.params),Object.keys(this.list).forEach((e=>{this.list[e].updateRender()}))}}init(){this.wavesurfer.isReady?(this._onBackendCreated(),this._onReady()):(this.wavesurfer.once("ready",this._onReady),this.wavesurfer.once("backend-created",this._onBackendCreated))}destroy(){this.wavesurfer.un("ready",this._onReady),this.wavesurfer.un("backend-created",this._onBackendCreated),this.wavesurfer.setDisabledEventEmissions(["region-removed"]),this.disableDragSelection(),this.clear()}wouldExceedMaxRegions(){return this.maxRegions&&Object.keys(this.list).length>=this.maxRegions}add(e){if(this.wouldExceedMaxRegions())return null;!(e={edgeScrollWidth:this.params.edgeScrollWidth||this.defaultEdgeScrollWidth,...e}).formatTimeCallback&&this.params.formatTimeCallback&&(e={...e,formatTimeCallback:this.params.formatTimeCallback}),!e.minLength&&this.regionsMinLength&&(e={...e,minLength:this.regionsMinLength});const t=new this.wavesurfer.Region(e,this.util,this.wavesurfer);return this.list[t.id]=t,t.on("remove",(()=>{delete this.list[t.id]})),t}clear(){Object.keys(this.list).forEach((e=>{this.list[e].remove()}))}enableDragSelection(e){this.disableDragSelection();const t=e.slop||2,i=this.wavesurfer.drawer.container,s=!1!==e.scroll&&this.wavesurfer.params.scrollParent,r=e.scrollSpeed||1,n=e.scrollThreshold||10;let a,h,o,l,d,u,c,g=this.wavesurfer.getDuration(),p=0;const v=e=>{if(!l||!u)return;let t=this.wrapper.scrollLeft+r*u;this.wrapper.scrollLeft=t=Math.min(h,Math.max(0,t));const i=this.wavesurfer.drawer.handleEvent(e);l.update({start:Math.min(i*g,o*g),end:Math.max(i*g,o*g)}),t<h&&t>0&&window.requestAnimationFrame((()=>{v(e)}))},m=t=>{if(!(t.touches&&t.touches.length>1)){if(g=this.wavesurfer.getDuration(),d=t.targetTouches?t.targetTouches[0].identifier:null,h=this.wrapper.scrollWidth-this.wrapper.clientWidth,c=this.util.withOrientation(this.wrapper.getBoundingClientRect(),this.vertical),this.wavesurfer.params.splitChannels){const i=(t.touches?t.touches[0].clientY:t.clientY)-c.top,s=null!=this.wavesurfer.backend.buffer?this.wavesurfer.backend.buffer.numberOfChannels:1,r=this.wrapper.clientHeight/s,n=Math.floor(i/r);e.channelIdx=n;const a=this.wavesurfer.params.splitChannelsOptions.channelColors[n];a&&a.dragColor&&(e.color=a.dragColor)}a=!0,o=this.wavesurfer.drawer.handleEvent(t,!0),l=null,u=null}};this.wrapper.addEventListener("mousedown",m),this.wrapper.addEventListener("touchstart",m),this.on("disable-drag-selection",(()=>{this.wrapper.removeEventListener("touchstart",m),this.wrapper.removeEventListener("mousedown",m)}));const f=e=>{e.touches&&e.touches.length>1||(a=!1,p=0,u=null,l&&(this.util.preventClick(),l.fireEvent("update-end",e),this.wavesurfer.fireEvent("region-update-end",l,e)),l=null)};this.wrapper.addEventListener("mouseleave",f),this.wrapper.addEventListener("mouseup",f),this.wrapper.addEventListener("touchend",f),document.body.addEventListener("mouseup",f),document.body.addEventListener("touchend",f),this.on("disable-drag-selection",(()=>{document.body.removeEventListener("mouseup",f),document.body.removeEventListener("touchend",f),this.wrapper.removeEventListener("touchend",f),this.wrapper.removeEventListener("mouseup",f),this.wrapper.removeEventListener("mouseleave",f)}));const w=r=>{if(!a)return;if(++p<=t)return;if(r.touches&&r.touches.length>1)return;if(r.targetTouches&&r.targetTouches[0].identifier!=d)return;if(!l&&(l=this.add(e||{}),!l))return;const h=this.wavesurfer.drawer.handleEvent(r),m=this.wavesurfer.regions.util.getRegionSnapToGridValue(o*g),f=this.wavesurfer.regions.util.getRegionSnapToGridValue(h*g);l.update({start:Math.min(f,m),end:Math.max(f,m)});let w=this.util.withOrientation(r,this.vertical);if(s&&i.clientWidth<this.wrapper.scrollWidth){const e=w.clientX-c.left;u=e<=n?-1:e>=c.right-n?1:null,u&&v(r)}};this.wrapper.addEventListener("mousemove",w),this.wrapper.addEventListener("touchmove",w),this.on("disable-drag-selection",(()=>{this.wrapper.removeEventListener("touchmove",w),this.wrapper.removeEventListener("mousemove",w)})),this.wavesurfer.on("region-created",(e=>{this.regionsMinLength&&(e.minLength=this.regionsMinLength)}))}disableDragSelection(){this.fireEvent("disable-drag-selection")}getCurrentRegion(){const e=this.wavesurfer.getCurrentTime();let t=null;return Object.keys(this.list).forEach((i=>{const s=this.list[i];s.start<=e&&s.end>=e&&(!t||s.end-s.start<t.end-t.start)&&(t=s)})),t}getRegionSnapToGridValue(e,t){if(t.snapToGridInterval){const i=t.snapToGridOffset||0;return Math.round((e-i)/t.snapToGridInterval)*t.snapToGridInterval+i}return e}}return t})()));
//# sourceMappingURL=wavesurfer.regions.min.js.map