/*!
 * wavesurfer.js elan plugin 6.0.4 (2022-09-28)
 * https://wavesurfer-js.org
 * @license BSD-3-Clause
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WaveSurfer",[],t):"object"==typeof exports?exports.WaveSurfer=t():(e.WaveSurfer=e.WaveSurfer||{},e.WaveSurfer.elan=t())}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>n});class n{static create(e){return{name:"elan",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,instance:n}}Types={ALIGNABLE_ANNOTATION:"ALIGNABLE_ANNOTATION",REF_ANNOTATION:"REF_ANNOTATION"};constructor(e,t){if(this.data=null,this.params=e,this.container="string"==typeof e.container?document.querySelector(e.container):e.container,!this.container)throw Error("No container for ELAN")}init(){this.bindClick(),this.params.url&&this.load(this.params.url)}destroy(){this.container.removeEventListener("click",this._onClick),this.container.removeChild(this.table)}load(e){this.loadXML(e,(e=>{this.data=this.parseElan(e),this.render(),this.fireEvent("ready",this.data)}))}loadXML(e,t){const n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="document",n.send(),n.addEventListener("load",(e=>{t&&t(e.target.responseXML)}))}parseElan(e){const t=Array.prototype.forEach,n=Array.prototype.map,r={media:{},timeOrder:{},tiers:[],annotations:{},alignableAnnotations:[]},a=e.querySelector("HEADER"),i="milliseconds"==a.getAttribute("TIME_UNITS"),o=a.querySelector("MEDIA_DESCRIPTOR");r.media.url=o.getAttribute("MEDIA_URL"),r.media.type=o.getAttribute("MIME_TYPE");const s=e.querySelectorAll("TIME_ORDER TIME_SLOT"),d={};return t.call(s,(e=>{let t=parseFloat(e.getAttribute("TIME_VALUE"));i&&(t=Math.round(100*t)/1e5),d[e.getAttribute("TIME_SLOT_ID")]=t})),r.tiers=n.call(e.querySelectorAll("TIER"),(e=>({id:e.getAttribute("TIER_ID"),linguisticTypeRef:e.getAttribute("LINGUISTIC_TYPE_REF"),defaultLocale:e.getAttribute("DEFAULT_LOCALE"),annotations:n.call(e.querySelectorAll("REF_ANNOTATION, ALIGNABLE_ANNOTATION"),(e=>{const t={type:e.nodeName,id:e.getAttribute("ANNOTATION_ID"),ref:e.getAttribute("ANNOTATION_REF"),value:e.querySelector("ANNOTATION_VALUE").textContent.trim()};return this.Types.ALIGNABLE_ANNOTATION==t.type&&(t.start=d[e.getAttribute("TIME_SLOT_REF1")],t.end=d[e.getAttribute("TIME_SLOT_REF2")],r.alignableAnnotations.push(t)),r.annotations[t.id]=t,t}))}))),r.tiers.forEach((e=>{e.annotations.forEach((e=>{null!=e.ref&&(e.reference=r.annotations[e.ref])}))})),r.alignableAnnotations.sort(((e,t)=>{let n=e.start-t.start;return 0==n&&(n=t.end-e.end),n})),r.length=r.alignableAnnotations.length,r}render(){let e=this.data.tiers;this.params.tiers&&(e=e.filter((e=>e.id in this.params.tiers)));const t={};let n={};e.forEach(((e,r)=>{e.annotations.forEach((e=>{e.reference&&e.reference.type==this.Types.ALIGNABLE_ANNOTATION&&(e.reference.id in t||(t[e.ref]={}),t[e.ref][r]=e,n[r]=!0)}))})),n=Object.keys(n).sort(),this.renderedAlignable=this.data.alignableAnnotations.filter((e=>t[e.id]));const r=this.table=document.createElement("table");r.className="wavesurfer-annotations";const a=document.createElement("thead"),i=document.createElement("tr");a.appendChild(i),r.appendChild(a);const o=document.createElement("th");o.textContent="Time",o.className="wavesurfer-time",i.appendChild(o),n.forEach((t=>{const n=e[t],r=document.createElement("th");r.className="wavesurfer-tier-"+n.id,r.textContent=n.id,this.params.tiers&&(r.style.width=this.params.tiers[n.id]),i.appendChild(r)}));const s=document.createElement("tbody");r.appendChild(s),this.renderedAlignable.forEach((r=>{const a=document.createElement("tr");a.id="wavesurfer-alignable-"+r.id,s.appendChild(a);const i=document.createElement("td");i.className="wavesurfer-time",i.textContent=r.start.toFixed(1)+"â€“"+r.end.toFixed(1),a.appendChild(i);const o=t[r.id];n.forEach((t=>{const n=e[t],i=document.createElement("td"),s=o[t];s&&(i.id="wavesurfer-annotation-"+s.id,i.dataset.ref=r.id,i.dataset.start=r.start,i.dataset.end=r.end,i.textContent=s.value),i.className="wavesurfer-tier-"+n.id,a.appendChild(i)}))})),this.container.innerHTML="",this.container.appendChild(r)}bindClick(){this._onClick=e=>{const t=e.target.dataset.ref;if(null!=t){const e=this.data.annotations[t];e&&this.fireEvent("select",e.start,e.end)}},this.container.addEventListener("click",this._onClick)}getRenderedAnnotation(e){let t;return this.renderedAlignable.some((n=>n.start<=e&&n.end>=e&&(t=n,!0))),t}getAnnotationNode(e){return document.getElementById("wavesurfer-alignable-"+e.id)}}return t})()));
//# sourceMappingURL=wavesurfer.elan.min.js.map