{"version":3,"file":"wavesurfer.elan.js","mappings":"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","sources":["webpack://WaveSurfer/webpack/universalModuleDefinition","webpack://WaveSurfer/webpack/bootstrap","webpack://WaveSurfer/webpack/runtime/define property getters","webpack://WaveSurfer/webpack/runtime/hasOwnProperty shorthand","webpack://WaveSurfer/webpack/runtime/make namespace object","webpack://WaveSurfer/./src/plugin/elan/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"WaveSurfer\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WaveSurfer\"] = factory();\n\telse\n\t\troot[\"WaveSurfer\"] = root[\"WaveSurfer\"] || {}, root[\"WaveSurfer\"][\"elan\"] = factory();\n})(self, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\r\n * @typedef {Object} ElanPluginParams\r\n * @property {string|HTMLElement} container CSS selector or HTML element where\r\n * the ELAN information should be rendered.\r\n * @property {string} url The location of ELAN XML data\r\n * @property {?boolean} deferInit Set to true to manually call\r\n * @property {?Object} tiers If set only shows the data tiers with the `TIER_ID`\r\n * in this map.\r\n */\r\n\r\n/**\r\n * Downloads and renders ELAN audio transcription documents alongside the\r\n * waveform.\r\n *\r\n * @implements {PluginClass}\r\n * @extends {Observer}\r\n * @example\r\n * // es6\r\n * import ElanPlugin from 'wavesurfer.elan.js';\r\n *\r\n * // commonjs\r\n * var ElanPlugin = require('wavesurfer.elan.js');\r\n *\r\n * // if you are using <script> tags\r\n * var ElanPlugin = window.WaveSurfer.elan;\r\n *\r\n * // ... initialising wavesurfer with the plugin\r\n * var wavesurfer = WaveSurfer.create({\r\n *   // wavesurfer options ...\r\n *   plugins: [\r\n *     ElanPlugin.create({\r\n *       // plugin options ...\r\n *     })\r\n *   ]\r\n * });\r\n */\r\nexport default class ElanPlugin {\r\n    /**\r\n     * Elan plugin definition factory\r\n     *\r\n     * This function must be used to create a plugin definition which can be\r\n     * used by wavesurfer to correctly instantiate the plugin.\r\n     *\r\n     * @param  {ElanPluginParams} params parameters use to initialise the plugin\r\n     * @return {PluginDefinition} an object representing the plugin\r\n     */\r\n    static create(params) {\r\n        return {\r\n            name: 'elan',\r\n            deferInit: params && params.deferInit ? params.deferInit : false,\r\n            params: params,\r\n            instance: ElanPlugin\r\n        };\r\n    }\r\n\r\n    Types = {\r\n        ALIGNABLE_ANNOTATION: 'ALIGNABLE_ANNOTATION',\r\n        REF_ANNOTATION: 'REF_ANNOTATION'\r\n    };\r\n\r\n    constructor(params, ws) {\r\n        this.data = null;\r\n        this.params = params;\r\n        this.container =\r\n            'string' == typeof params.container\r\n                ? document.querySelector(params.container)\r\n                : params.container;\r\n\r\n        if (!this.container) {\r\n            throw Error('No container for ELAN');\r\n        }\r\n    }\r\n\r\n    init() {\r\n        this.bindClick();\r\n\r\n        if (this.params.url) {\r\n            this.load(this.params.url);\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        this.container.removeEventListener('click', this._onClick);\r\n        this.container.removeChild(this.table);\r\n    }\r\n\r\n    load(url) {\r\n        this.loadXML(url, xml => {\r\n            this.data = this.parseElan(xml);\r\n            this.render();\r\n            this.fireEvent('ready', this.data);\r\n        });\r\n    }\r\n\r\n    loadXML(url, callback) {\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.open('GET', url, true);\r\n        xhr.responseType = 'document';\r\n        xhr.send();\r\n        xhr.addEventListener('load', e => {\r\n            callback && callback(e.target.responseXML);\r\n        });\r\n    }\r\n\r\n    parseElan(xml) {\r\n        const _forEach = Array.prototype.forEach;\r\n        const _map = Array.prototype.map;\r\n\r\n        const data = {\r\n            media: {},\r\n            timeOrder: {},\r\n            tiers: [],\r\n            annotations: {},\r\n            alignableAnnotations: []\r\n        };\r\n\r\n        const header = xml.querySelector('HEADER');\r\n        const inMilliseconds =\r\n            header.getAttribute('TIME_UNITS') == 'milliseconds';\r\n        const media = header.querySelector('MEDIA_DESCRIPTOR');\r\n        data.media.url = media.getAttribute('MEDIA_URL');\r\n        data.media.type = media.getAttribute('MIME_TYPE');\r\n\r\n        const timeSlots = xml.querySelectorAll('TIME_ORDER TIME_SLOT');\r\n        const timeOrder = {};\r\n        _forEach.call(timeSlots, slot => {\r\n            let value = parseFloat(slot.getAttribute('TIME_VALUE'));\r\n            // If in milliseconds, convert to seconds with rounding\r\n            if (inMilliseconds) {\r\n                value = Math.round(value * 1e2) / 1e5;\r\n            }\r\n            timeOrder[slot.getAttribute('TIME_SLOT_ID')] = value;\r\n        });\r\n\r\n        data.tiers = _map.call(xml.querySelectorAll('TIER'), tier => ({\r\n            id: tier.getAttribute('TIER_ID'),\r\n            linguisticTypeRef: tier.getAttribute('LINGUISTIC_TYPE_REF'),\r\n            defaultLocale: tier.getAttribute('DEFAULT_LOCALE'),\r\n            annotations: _map.call(\r\n                tier.querySelectorAll('REF_ANNOTATION, ALIGNABLE_ANNOTATION'),\r\n                node => {\r\n                    const annot = {\r\n                        type: node.nodeName,\r\n                        id: node.getAttribute('ANNOTATION_ID'),\r\n                        ref: node.getAttribute('ANNOTATION_REF'),\r\n                        value: node\r\n                            .querySelector('ANNOTATION_VALUE')\r\n                            .textContent.trim()\r\n                    };\r\n\r\n                    if (this.Types.ALIGNABLE_ANNOTATION == annot.type) {\r\n                        // Add start & end to alignable annotation\r\n                        annot.start =\r\n                            timeOrder[node.getAttribute('TIME_SLOT_REF1')];\r\n                        annot.end =\r\n                            timeOrder[node.getAttribute('TIME_SLOT_REF2')];\r\n                        // Add to the list of alignable annotations\r\n                        data.alignableAnnotations.push(annot);\r\n                    }\r\n\r\n                    // Additionally, put into the flat map of all annotations\r\n                    data.annotations[annot.id] = annot;\r\n\r\n                    return annot;\r\n                }\r\n            )\r\n        }));\r\n\r\n        // Create JavaScript references between annotations\r\n        data.tiers.forEach(tier => {\r\n            tier.annotations.forEach(annot => {\r\n                if (null != annot.ref) {\r\n                    annot.reference = data.annotations[annot.ref];\r\n                }\r\n            });\r\n        });\r\n\r\n        // Sort alignable annotations by start & end\r\n        data.alignableAnnotations.sort((a, b) => {\r\n            let d = a.start - b.start;\r\n            if (d == 0) {\r\n                d = b.end - a.end;\r\n            }\r\n            return d;\r\n        });\r\n\r\n        data.length = data.alignableAnnotations.length;\r\n\r\n        return data;\r\n    }\r\n\r\n    render() {\r\n        // apply tiers filter\r\n        let tiers = this.data.tiers;\r\n        if (this.params.tiers) {\r\n            tiers = tiers.filter(tier => tier.id in this.params.tiers);\r\n        }\r\n\r\n        // denormalize references to alignable annotations\r\n        const backRefs = {};\r\n        let indeces = {};\r\n        tiers.forEach((tier, index) => {\r\n            tier.annotations.forEach(annot => {\r\n                if (\r\n                    annot.reference &&\r\n                    annot.reference.type == this.Types.ALIGNABLE_ANNOTATION\r\n                ) {\r\n                    if (!(annot.reference.id in backRefs)) {\r\n                        backRefs[annot.ref] = {};\r\n                    }\r\n                    backRefs[annot.ref][index] = annot;\r\n                    indeces[index] = true;\r\n                }\r\n            });\r\n        });\r\n        indeces = Object.keys(indeces).sort();\r\n\r\n        this.renderedAlignable = this.data.alignableAnnotations.filter(\r\n            alignable => backRefs[alignable.id]\r\n        );\r\n\r\n        // table\r\n        const table = (this.table = document.createElement('table'));\r\n        table.className = 'wavesurfer-annotations';\r\n\r\n        // head\r\n        const thead = document.createElement('thead');\r\n        const headRow = document.createElement('tr');\r\n        thead.appendChild(headRow);\r\n        table.appendChild(thead);\r\n        const th = document.createElement('th');\r\n        th.textContent = 'Time';\r\n        th.className = 'wavesurfer-time';\r\n        headRow.appendChild(th);\r\n        indeces.forEach(index => {\r\n            const tier = tiers[index];\r\n            const th = document.createElement('th');\r\n            th.className = 'wavesurfer-tier-' + tier.id;\r\n            th.textContent = tier.id;\r\n            if (this.params.tiers) { th.style.width = this.params.tiers[tier.id]; }\r\n            headRow.appendChild(th);\r\n        });\r\n\r\n        // body\r\n        const tbody = document.createElement('tbody');\r\n        table.appendChild(tbody);\r\n        this.renderedAlignable.forEach(alignable => {\r\n            const row = document.createElement('tr');\r\n            row.id = 'wavesurfer-alignable-' + alignable.id;\r\n            tbody.appendChild(row);\r\n\r\n            const td = document.createElement('td');\r\n            td.className = 'wavesurfer-time';\r\n            td.textContent =\r\n                alignable.start.toFixed(1) + 'â€“' + alignable.end.toFixed(1);\r\n            row.appendChild(td);\r\n\r\n            const backRef = backRefs[alignable.id];\r\n            indeces.forEach(index => {\r\n                const tier = tiers[index];\r\n                const td = document.createElement('td');\r\n                const annotation = backRef[index];\r\n                if (annotation) {\r\n                    td.id = 'wavesurfer-annotation-' + annotation.id;\r\n                    td.dataset.ref = alignable.id;\r\n                    td.dataset.start = alignable.start;\r\n                    td.dataset.end = alignable.end;\r\n                    td.textContent = annotation.value;\r\n                }\r\n                td.className = 'wavesurfer-tier-' + tier.id;\r\n                row.appendChild(td);\r\n            });\r\n        });\r\n\r\n        this.container.innerHTML = '';\r\n        this.container.appendChild(table);\r\n    }\r\n\r\n    bindClick() {\r\n        this._onClick = e => {\r\n            const ref = e.target.dataset.ref;\r\n            if (null != ref) {\r\n                const annot = this.data.annotations[ref];\r\n                if (annot) {\r\n                    this.fireEvent('select', annot.start, annot.end);\r\n                }\r\n            }\r\n        };\r\n        this.container.addEventListener('click', this._onClick);\r\n    }\r\n\r\n    getRenderedAnnotation(time) {\r\n        let result;\r\n        this.renderedAlignable.some(annotation => {\r\n            if (annotation.start <= time && annotation.end >= time) {\r\n                result = annotation;\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n        return result;\r\n    }\r\n\r\n    getAnnotationNode(annotation) {\r\n        return document.getElementById('wavesurfer-alignable-' + annotation.id);\r\n    }\r\n}\r\n"],"names":["ElanPlugin","create","params","name","deferInit","instance","Types","ALIGNABLE_ANNOTATION","REF_ANNOTATION","constructor","ws","data","container","document","querySelector","Error","init","bindClick","url","load","destroy","removeEventListener","_onClick","removeChild","table","loadXML","xml","parseElan","render","fireEvent","callback","xhr","XMLHttpRequest","open","responseType","send","addEventListener","e","target","responseXML","_forEach","Array","prototype","forEach","_map","map","media","timeOrder","tiers","annotations","alignableAnnotations","header","inMilliseconds","getAttribute","type","timeSlots","querySelectorAll","call","slot","value","parseFloat","Math","round","tier","id","linguisticTypeRef","defaultLocale","node","annot","nodeName","ref","textContent","trim","start","end","push","reference","sort","a","b","d","length","filter","backRefs","indeces","index","Object","keys","renderedAlignable","alignable","createElement","className","thead","headRow","appendChild","th","style","width","tbody","row","td","toFixed","backRef","annotation","dataset","innerHTML","getRenderedAnnotation","time","result","some","getAnnotationNode","getElementById"],"sourceRoot":""}