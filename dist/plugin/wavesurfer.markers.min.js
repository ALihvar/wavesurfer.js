/*!
 * wavesurfer.js markers plugin 6.0.4 (2022-09-28)
 * https://wavesurfer-js.org
 * @license BSD-3-Clause
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WaveSurfer",[],t):"object"==typeof exports?exports.WaveSurfer=t():(e.WaveSurfer=e.WaveSurfer||{},e.WaveSurfer.markers=t())}(self,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>r});class r{static create(e){return{name:"markers",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,staticProps:{addMarker(e){return this.initialisedPluginList.markers||this.initPlugin("markers"),this.markers.add(e)},clearMarkers(){this.markers&&this.markers.clear()}},instance:r}}constructor(e,t){this.params=e,this.wavesurfer=t,this.util=t.util,this.style=this.util.style,this.markerLineWidth=1,this.markerWidth=11,this.markerHeight=22,this.dragging=!1,this._onResize=()=>{this._updateMarkerPositions()},this._onBackendCreated=()=>{this.wrapper=this.wavesurfer.drawer.wrapper,this.params.markers&&this.params.markers.forEach((e=>this.add(e))),window.addEventListener("resize",this._onResize,!0),window.addEventListener("orientationchange",this._onResize,!0),this.wavesurfer.on("zoom",this._onResize),this.markers.find((e=>e.draggable))&&(this.onMouseMove=e=>this._onMouseMove(e),window.addEventListener("mousemove",this.onMouseMove),this.onMouseUp=e=>this._onMouseUp(e),window.addEventListener("mouseup",this.onMouseUp))},this.markers=[],this._onReady=()=>{this.wrapper=this.wavesurfer.drawer.wrapper,this._updateMarkerPositions()}}init(){this.wavesurfer.isReady?(this._onBackendCreated(),this._onReady()):(this.wavesurfer.once("ready",this._onReady),this.wavesurfer.once("backend-created",this._onBackendCreated))}destroy(){this.wavesurfer.un("ready",this._onReady),this.wavesurfer.un("backend-created",this._onBackendCreated),this.wavesurfer.un("zoom",this._onResize),window.removeEventListener("resize",this._onResize,!0),window.removeEventListener("orientationchange",this._onResize,!0),this.onMouseMove&&window.removeEventListener("mousemove",this.onMouseMove),this.onMouseUp&&window.removeEventListener("mouseup",this.onMouseUp),this.clear()}add(e){let t={time:e.time,label:e.label,color:e.color||"#D8D8D8",position:e.position||"bottom",draggable:!!e.draggable};return t.el=this._createMarkerElement(t,e.markerElement),this.wrapper.appendChild(t.el),this.markers.push(t),this._updateMarkerPositions(),t}remove(e){let t=this.markers[e];t&&(this.wrapper.removeChild(t.el),this.markers.splice(e,1))}_createPointerSVG(e,t){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),s=document.createElementNS(r,"polygon");return i.setAttribute("viewBox","0 0 40 80"),s.setAttribute("id","polygon"),s.setAttribute("stroke","#979797"),s.setAttribute("fill",e),s.setAttribute("points","20 0 40 30 40 80 0 80 0 30"),"top"==t&&s.setAttribute("transform","rotate(180, 20 40)"),i.appendChild(s),this.style(i,{width:this.markerWidth+"px",height:this.markerHeight+"px","min-width":this.markerWidth+"px","margin-right":"5px","z-index":4}),i}_createMarkerElement(e,t){let r=e.label;const i=document.createElement("marker");i.className="wavesurfer-marker",this.style(i,{position:"absolute",height:"100%",display:"flex",overflow:"hidden","flex-direction":"top"==e.position?"column-reverse":"column"});const s=document.createElement("div"),a=t?t.width:this.markerWidth;e.offset=(a-this.markerLineWidth)/2,this.style(s,{"flex-grow":1,"margin-left":e.offset+"px",background:"black",width:this.markerLineWidth+"px",opacity:.1}),i.appendChild(s);const o=document.createElement("div"),n=t||this._createPointerSVG(e.color,e.position);if(e.draggable&&(n.draggable=!1),o.appendChild(n),r){const e=document.createElement("span");e.innerText=r,this.style(e,{"font-family":"monospace","font-size":"90%"}),o.appendChild(e)}return this.style(o,{display:"flex","align-items":"center",cursor:"pointer"}),i.appendChild(o),o.addEventListener("click",(t=>{t.stopPropagation(),this.dragging||(this.wavesurfer.setCurrentTime(e.time),this.wavesurfer.fireEvent("marker-click",e,t))})),e.draggable&&o.addEventListener("mousedown",(t=>{this.selectedMarker=e})),i}_updateMarkerPositions(){for(let e=0;e<this.markers.length;e++){let t=this.markers[e];this._updateMarkerPosition(t)}}_updateMarkerPosition(e){const t=this.wavesurfer.getDuration(),r=this.wavesurfer.drawer.width/this.wavesurfer.params.pixelRatio,i=r*Math.min(e.time/t,1)-e.offset;this.style(e.el,{left:i+"px","max-width":r-i+"px"})}_onMouseMove(e){this.selectedMarker&&(this.dragging||(this.dragging=!0,this.wavesurfer.fireEvent("marker-drag",this.selectedMarker,e)),this.selectedMarker.time=this.wavesurfer.drawer.handleEvent(e)*this.wavesurfer.getDuration(),this._updateMarkerPositions())}_onMouseUp(e){if(this.selectedMarker&&setTimeout((()=>{this.selectedMarker=!1,this.dragging=!1}),0),!this.dragging)return;e.stopPropagation();const t=this.wavesurfer.getDuration();this.selectedMarker.time=this.wavesurfer.drawer.handleEvent(e)*t,this._updateMarkerPositions(),this.wavesurfer.fireEvent("marker-drop",this.selectedMarker,e)}clear(){for(;this.markers.length>0;)this.remove(0)}}return t})()));
//# sourceMappingURL=wavesurfer.markers.min.js.map