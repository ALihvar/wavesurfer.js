/*!
 * wavesurfer.js minimap plugin 6.0.4 (2022-09-28)
 * https://wavesurfer-js.org
 * @license BSD-3-Clause
 */
!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("WaveSurfer",[],r):"object"==typeof exports?exports.WaveSurfer=r():(e.WaveSurfer=e.WaveSurfer||{},e.WaveSurfer.minimap=r())}(self,(()=>(()=>{"use strict";var e={d:(r,i)=>{for(var t in i)e.o(i,t)&&!e.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:i[t]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},r={};e.r(r),e.d(r,{default:()=>i});class i{static create(e){return{name:"minimap",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,staticProps:{},instance:i}}constructor(e,r){if(this.params=Object.assign({},r.params,{showRegions:!1,regionsPluginName:e.regionsPluginName||"regions",showOverview:!1,overviewBorderColor:"green",overviewBorderSize:2,container:!1,height:Math.max(Math.round(r.params.height/4),20)},e,{scrollParent:!1,fillParent:!0}),"string"==typeof e.container){const r=document.querySelector(e.container);r||console.warn(`Wavesurfer minimap container ${e.container} was not found! The minimap will be automatically appended below the waveform.`),this.params.container=r}e.container||(this.params.container=r.util.style(document.createElement("minimap"),{display:"block"})),this.drawer=new r.Drawer(this.params.container,this.params),this.wavesurfer=r,this.util=r.util,this.renderEvent="redraw",this.overviewRegion=null,this.regionsPlugin=this.wavesurfer[this.params.regionsPluginName],this.drawer.createWrapper(),this.createElements();let i=!1;this._onShouldRender=()=>{i||(this.bindWavesurferEvents(),this.bindMinimapEvents(),i=!0),document.body.contains(this.params.container)||r.container.insertBefore(this.params.container,null),this.regionsPlugin&&this.params.showRegions&&this.regions(),this.render()},this._onAudioprocess=e=>{this.drawer.progress(this.wavesurfer.backend.getPlayedPercents())},this._onSeek=()=>this.drawer.progress(r.backend.getPlayedPercents()),this._onScroll=e=>{if(!this.draggingOverview){const r=this.util.withOrientation(e.target,this.wavesurfer.params.vertical);this.moveOverviewRegion(r.scrollLeft/this.ratio)}},this._onMouseover=e=>{this.draggingOverview&&(this.draggingOverview=!1)};let t=0;this._onResize=r.util.debounce((()=>{t!=this.drawer.wrapper.clientWidth&&(t=this.drawer.wrapper.clientWidth,this.render(),this.drawer.progress(this.wavesurfer.backend.getPlayedPercents()))})),this._onZoom=e=>{this.render()},this.wavesurfer.on("zoom",this._onZoom)}init(){this.wavesurfer.isReady&&this._onShouldRender(),this.wavesurfer.on(this.renderEvent,this._onShouldRender)}destroy(){window.removeEventListener("resize",this._onResize,!0),window.removeEventListener("orientationchange",this._onResize,!0),this.wavesurfer.drawer.wrapper.removeEventListener("mouseover",this._onMouseover),this.wavesurfer.un(this.renderEvent,this._onShouldRender),this.wavesurfer.un("seek",this._onSeek),this.wavesurfer.un("scroll",this._onScroll),this.wavesurfer.un("audioprocess",this._onAudioprocess),this.wavesurfer.un("zoom",this._onZoom),this.drawer.destroy(),this.overviewRegion=null,this.unAll()}regions(){this.regions={},this.wavesurfer.on("region-created",(e=>{this.regions[e.id]=e,this.drawer.wrapper&&this.renderRegions()})),this.wavesurfer.on("region-updated",(e=>{this.regions[e.id]=e,this.drawer.wrapper&&this.renderRegions()})),this.wavesurfer.on("region-removed",(e=>{delete this.regions[e.id],this.drawer.wrapper&&this.renderRegions()}))}renderRegions(){const e=this.drawer.wrapper.querySelectorAll("region");let r;for(r=0;r<e.length;++r)this.drawer.wrapper.removeChild(e[r]);Object.keys(this.regions).forEach((e=>{const r=this.regions[e],i=this.getWidth()*((r.end-r.start)/this.wavesurfer.getDuration()),t=this.getWidth()*(r.start/this.wavesurfer.getDuration()),s=this.util.style(document.createElement("region"),{height:"inherit",backgroundColor:r.color,width:i+"px",left:t+"px",display:"block",position:"absolute"});s.classList.add(e),this.drawer.wrapper.appendChild(s)}))}createElements(){this.drawer.createElements(),this.params.showOverview&&(this.overviewRegion=this.util.withOrientation(this.drawer.wrapper.appendChild(document.createElement("overview")),this.wavesurfer.params.vertical),this.util.style(this.overviewRegion,{top:0,bottom:0,width:"0px",display:"block",position:"absolute",cursor:"move",border:this.params.overviewBorderSize+"px solid "+this.params.overviewBorderColor,zIndex:2,opacity:this.params.overviewOpacity}))}bindWavesurferEvents(){window.addEventListener("resize",this._onResize,!0),window.addEventListener("orientationchange",this._onResize,!0),this.wavesurfer.on("audioprocess",this._onAudioprocess),this.wavesurfer.on("seek",this._onSeek),this.params.showOverview&&(this.wavesurfer.on("scroll",this._onScroll),this.wavesurfer.drawer.wrapper.addEventListener("mouseover",this._onMouseover))}bindMinimapEvents(){const e={clientX:0,clientY:0};let r=0,i=!0;this.params.interact&&(this.drawer.wrapper.addEventListener("click",(e=>{this.fireEvent("click",e,this.drawer.handleEvent(e))})),this.on("click",((e,r)=>{i?(this.drawer.progress(r),this.wavesurfer.seekAndCenter(r)):i=!0}))),this.params.showOverview&&(this.overviewRegion.domElement.addEventListener("mousedown",(i=>{const t=this.util.withOrientation(i,this.wavesurfer.params.vertical);this.draggingOverview=!0,r=t.layerX,e.clientX=t.clientX,e.clientY=t.clientY})),this.drawer.wrapper.addEventListener("mousemove",(e=>{if(this.draggingOverview){const i=this.util.withOrientation(e,this.wavesurfer.params.vertical);this.moveOverviewRegion(i.clientX-this.drawer.container.getBoundingClientRect().left-r)}})),this.drawer.wrapper.addEventListener("mouseup",(r=>{const t=this.util.withOrientation(r,this.wavesurfer.params.vertical);e.clientX-t.clientX==0&&e.clientX-t.clientX==0?(i=!0,this.draggingOverview=!1):this.draggingOverview&&(i=!1,this.draggingOverview=!1)})))}render(){const e=this.drawer.getWidth(),r=this.wavesurfer.backend.getPeaks(e,0,e);this.drawer.drawPeaks(r,e,0,e),this.drawer.progress(this.wavesurfer.backend.getPlayedPercents()),this.params.showOverview&&(this.ratio=this.wavesurfer.drawer.width/this.drawer.width,this.waveShowedWidth=this.wavesurfer.drawer.width/this.ratio,this.waveWidth=this.wavesurfer.drawer.width,this.overviewWidth=this.drawer.container.offsetWidth/this.ratio,this.overviewPosition=0,this.moveOverviewRegion(this.wavesurfer.drawer.wrapper.scrollLeft/this.ratio),this.util.style(this.overviewRegion,{width:this.overviewWidth+"px"}))}moveOverviewRegion(e){e<0?this.overviewPosition=0:e+this.overviewWidth<this.drawer.container.offsetWidth?this.overviewPosition=e:this.overviewPosition=this.drawer.container.offsetWidth-this.overviewWidth,this.util.style(this.overviewRegion,{left:this.overviewPosition+"px"}),this.draggingOverview&&(this.wavesurfer.drawer.wrapper.scrollLeft=this.overviewPosition*this.ratio)}getWidth(){return this.drawer.width/this.params.pixelRatio}}return r})()));
//# sourceMappingURL=wavesurfer.minimap.min.js.map